<ion-content>
  <!-- Men√∫ lateral -->
  <ion-menu contentId="main-content">
    <ion-header>
      <ion-toolbar>
        <ion-title>Men√∫</ion-title>
      </ion-toolbar>
    </ion-header>
    
    <ion-content class="ion-padding">
      <ion-button expand="block" fill="outline" (click)="goToAddReview()">
        <ion-icon name="add-circle" slot="start"></ion-icon>
        Agregar Rese√±a
      </ion-button>
      
      <ion-button expand="block" fill="outline" (click)="goToMyReviews()">
        <ion-icon name="list" slot="start"></ion-icon>
        Mis Rese√±as
      </ion-button>
      
      <ion-button expand="block" fill="outline" (click)="onLogout()">
        <ion-icon name="log-out" slot="start"></ion-icon>
        Cerrar Sesi√≥n
      </ion-button>
    </ion-content>
  </ion-menu>

  <!-- Contenido principal -->
  <div class="ion-page" id="main-content">
    <ion-header>
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-menu-button></ion-menu-button>
        </ion-buttons>
        <ion-title>NekoRate</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="presentActionSheet()">
            <ion-icon name="camera"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
      
      <!-- Barra de b√∫squeda -->
      <ion-toolbar>
        <ion-searchbar 
          placeholder="Buscar anime..." 
          [(ngModel)]="searchQuery"
          (ionInput)="searchAnimes()">
        </ion-searchbar>
      </ion-toolbar>
    </ion-header>

    <ion-content class="ion-padding">
      <ion-refresher slot="fixed" (ionRefresh)="onRefresh($event)">
        <ion-refresher-content></ion-refresher-content>
      </ion-refresher>

      <!-- Estado de Conectividad -->
      <app-connectivity-status></app-connectivity-status>

      <!-- Layout de dos columnas -->
      <div class="main-layout">
        <!-- Columna principal (izquierda) -->
        <div class="main-content">
          <!-- Secci√≥n de Fotos -->
          <div class="photos-section" *ngIf="photos.length > 0">
            <h2 class="section-title">Mis Fotos</h2>
            <div class="photos-grid">
              <div class="photo-item" *ngFor="let photo of photos">
                <img [src]="photo.webviewPath" alt="Foto capturada">
                <ion-button 
                  fill="clear" 
                  color="danger" 
                  size="small"
                  (click)="deletePhoto(photo)">
                  <ion-icon name="trash"></ion-icon>
                </ion-button>
              </div>
            </div>
          </div>

          <!-- Secci√≥n de Mis Rese√±as -->
          <div class="reviews-section" *ngIf="customReviews.length > 0">
            <div class="section-header">
              <h2 class="section-title">Mis Rese√±as</h2>
              <ion-button 
                fill="clear" 
                size="small" 
                color="primary"
                (click)="goToMyReviews()">
                <ion-icon name="create" slot="start"></ion-icon>
                Gestionar
              </ion-button>
            </div>
            
            <div class="reviews-slider" *ngIf="customReviews.length > 0">
              <div class="slider-container">
                <ion-card class="review-card" *ngFor="let review of customReviews">
                  <div class="card-image" *ngIf="review.photo">
                    <img [src]="review.photo.webviewPath" [alt]="review.animeTitle">
                    <div class="rating-overlay">
                      <div class="stars">
                        <ion-icon 
                          *ngFor="let star of getStarsArray(review.calificacion)" 
                          name="star" 
                          color="warning">
                        </ion-icon>
                      </div>
                      <span class="rating-number">{{ review.calificacion }}/5</span>
                    </div>
                  </div>
                  
                  <div class="card-content">
                    <div class="review-header">
                      <h3 class="anime-title">{{ review.animeTitle }}</h3>
                      <div class="review-actions">
                        <button 
                          type="button"
                          class="edit-btn"
                          (click)="editReview(review)">
                          ‚úèÔ∏è Editar
                        </button>
                        <button 
                          type="button"
                          class="delete-btn"
                          (click)="deleteReview(review)">
                          üóëÔ∏è Eliminar
                        </button>
                      </div>
                    </div>
                    
                    <div class="review-meta">
                      <span class="review-date">{{ formatDate(review.fecha) }}</span>
                      <div class="stars-inline">
                        <ion-icon 
                          *ngFor="let star of getStarsArray(review.calificacion)" 
                          name="star" 
                          color="warning">
                        </ion-icon>
                      </div>
                    </div>
                    
                    <p class="review-comment">{{ review.comentario }}</p>
                  </div>
                </ion-card>
              </div>
            </div>
          </div>

          <!-- Secci√≥n de Animes -->
          <div class="animes-section">
            <h2 class="section-title">Animes Populares</h2>
            
            <div *ngIf="loading" class="loading-container">
              <ion-spinner name="crescent"></ion-spinner>
              <p>Cargando animes...</p>
            </div>

            <div *ngIf="!loading && animes.length === 0" class="no-results">
              <ion-icon name="sad-outline" size="large"></ion-icon>
              <p>No se encontraron animes</p>
            </div>

            <ion-card class="anime-card" *ngFor="let anime of animes" (click)="goToAnimeDetail(anime.id)">
              <div class="card-image">
                <img [src]="anime.image" [alt]="anime.title" *ngIf="anime.image">
                <div class="rating-overlay" *ngIf="anime.rating">
                  <div class="stars">
                    <ion-icon 
                      *ngFor="let star of getStarsArray(anime.rating)" 
                      name="star" 
                      color="warning">
                    </ion-icon>
                  </div>
                  <span class="rating-number">{{ anime.rating | number:'1.1-1' }}</span>
                </div>
              </div>
              
              <div class="card-content">
                <div class="categories" *ngIf="anime.genres && anime.genres.length > 0">
                  <ion-chip 
                    *ngFor="let genre of anime.genres.slice(0, 2)" 
                    color="primary" 
                    size="small">
                    {{ genre.toUpperCase() }}
                  </ion-chip>
                </div>
                
                <h3 class="anime-title">{{ anime.title }}</h3>
                
                <div class="meta-info" *ngIf="anime.year">
                  <span class="year">{{ anime.year }}</span>
                  <span class="status" *ngIf="anime.status">{{ anime.status }}</span>
                </div>
                
                <p class="description" *ngIf="anime.description">
                  {{ anime.description | slice:0:150 }}{{ (anime.description && anime.description.length > 150) ? '...' : '' }}
                </p>
                
                <ion-button fill="clear" class="read-more-btn">
                  Ver detalles
                  <ion-icon name="arrow-forward" slot="end"></ion-icon>
                </ion-button>
              </div>
            </ion-card>
          </div>
        </div>

        <!-- Sidebar (derecha) -->
        <div class="sidebar">
          <!-- Secci√≥n de informaci√≥n adicional -->
          <div class="info-section">
            <h3 class="sidebar-title">NekoRate</h3>
            <p class="sidebar-description">
              NekoRate es tu plataforma de confianza para descubrir, calificar y compartir 
              tus animes favoritos. Encuentra rese√±as aut√©nticas de la comunidad otaku 
              y descubre nuevas series que se adapten a tus gustos.
            </p>
            <div class="contact-info">
              <h4>¬øTienes dudas?</h4>
              <p>Puedes contactarnos a trav√©s de:</p>
              <ul>
                <li>üìß Email: contacto&#64;nekorate.com</li>
                <li>üê¶ Twitter: &#64;NekoRateApp</li>
                <li>üì± Facebook: NekoRate Oficial</li>
              </ul>
            </div>
            <div class="spoiler-policy">
              <p class="spoiler-warning">
                ‚ö†Ô∏è <strong>Pol√≠tica de Spoilers:</strong><br>
                Nuestras rese√±as no contienen spoilers. En caso de haberlos, 
                lo indicamos claramente con una advertencia.
              </p>
            </div>
          </div>

          <!-- Secci√≥n de estad√≠sticas -->
          <div class="stats-section">
            <h3 class="sidebar-title">Estad√≠sticas</h3>
            <div class="stat-item">
              <span class="stat-number">{{ animes.length }}</span>
              <span class="stat-label">Animes Disponibles</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">{{ customReviews.length }}</span>
              <span class="stat-label">Tus Rese√±as</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">{{ photos.length }}</span>
              <span class="stat-label">Fotos Capturadas</span>
            </div>
          </div>

          <!-- Secci√≥n de enlaces √∫tiles -->
          <div class="links-section">
            <h3 class="sidebar-title">Enlaces √ötiles</h3>
            <div class="link-item">
              <ion-icon name="calendar" color="primary"></ion-icon>
              <span>Calendario de Temporadas</span>
            </div>
            <div class="link-item">
              <ion-icon name="trending-up" color="primary"></ion-icon>
              <span>Animes Trending</span>
            </div>
            <div class="link-item">
              <ion-icon name="people" color="primary"></ion-icon>
              <span>Comunidad Otaku</span>
            </div>
            <div class="link-item">
              <ion-icon name="book" color="primary"></ion-icon>
              <span>Gu√≠a de G√©neros</span>
            </div>
          </div>
        </div>
      </div>
    </ion-content>
  </div>
</ion-content>
