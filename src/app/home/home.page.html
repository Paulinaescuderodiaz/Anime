<ion-content>
  <ion-menu contentId="main-content">
    <ion-header>
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-menu-button></ion-menu-button>
        </ion-buttons>
        
        <ion-title class="app-title">NekoRate</ion-title>
        
        <div slot="end" class="user-section">
          <ion-avatar class="user-avatar">
            <img alt="Avatar del usuario" src="https://ionicframework.com/docs/img/demos/avatar.svg" />
          </ion-avatar>
          <ion-label class="user-name">{{ currentUser }}</ion-label>
        </div>
      </ion-toolbar>
      
      <!-- Barra de b√∫squeda en toolbar separado -->
      <ion-toolbar class="search-toolbar">
        <ion-searchbar 
          placeholder="Buscar anime..." 
          class="custom-searchbar"
          [(ngModel)]="searchQuery"
          (ionInput)="searchAnimes()">
        </ion-searchbar>
      </ion-toolbar>
    </ion-header>
    
    <ion-content class="ion-padding">
      <ion-button expand="block" fill="outline" (click)="goToAddReview()">
        <ion-icon name="add-circle" slot="start"></ion-icon>
        Agregar Rese√±a
      </ion-button>
      
      <ion-button expand="block" fill="outline" (click)="onLogout()">
        <ion-icon name="log-out" slot="start"></ion-icon>
        Cerrar Sesi√≥n
      </ion-button>
    </ion-content>
  </ion-menu>

  <div class="ion-page" id="main-content">
    <ion-header>
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-menu-button></ion-menu-button>
        </ion-buttons>
        <ion-title class="menu">NekoRate</ion-title>
        <ion-avatar slot="end" class="contenedor">
          <img alt="Silhouette of a person's head" src="https://ionicframework.com/docs/img/demos/avatar.svg" class="avatar" />
        </ion-avatar>
      </ion-toolbar>
    </ion-header>

    <ion-content class="ion-padding">
      <ion-refresher slot="fixed" (ionRefresh)="onRefresh($event)">
        <ion-refresher-content></ion-refresher-content>
      </ion-refresher>

      <!-- Secci√≥n de Fotos -->
      <div class="photos-section" *ngIf="photos.length > 0">
        <h2 class="section-title">Mis Fotos</h2>
        <div class="photos-grid">
          <div class="photo-item" *ngFor="let photo of photos">
            <img [src]="photo.webviewPath" alt="Foto capturada">
            <ion-button 
              fill="clear" 
              color="danger" 
              size="small"
              (click)="deletePhoto(photo)">
              <ion-icon name="trash"></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>

      <!-- Secci√≥n de Mis Rese√±as -->
      <div class="reviews-section" *ngIf="customReviews.length > 0">
        <div class="section-header">
          <h2 class="section-title">Mis Rese√±as</h2>
          <ion-button 
            fill="clear" 
            size="small" 
            color="primary"
            (click)="goToMyReviews()">
            <ion-icon name="create" slot="start"></ion-icon>
            Gestionar
          </ion-button>
        </div>
        
        <div class="reviews-slider" *ngIf="customReviews.length > 0">
          <div class="slider-container">
            <ion-card class="review-card" *ngFor="let review of customReviews">
              <div class="card-image" *ngIf="review.photo">
                <img [src]="review.photo.webviewPath" [alt]="review.animeTitle">
                <div class="rating-overlay">
                  <div class="stars">
                    <ion-icon 
                      *ngFor="let star of getStarsArray(review.calificacion)" 
                      name="star" 
                      color="warning">
                    </ion-icon>
                  </div>
                  <span class="rating-number">{{ review.calificacion }}/5</span>
                </div>
              </div>
              
              <div class="card-content">
                <div class="review-header">
                  <h3 class="anime-title">{{ review.animeTitle }}</h3>
                  <div class="review-actions">
                    <button 
                      type="button"
                      class="edit-btn"
                      (click)="editReview(review)">
                      ‚úèÔ∏è Editar
                    </button>
                    <button 
                      type="button"
                      class="delete-btn"
                      (click)="deleteReview(review)">
                      üóëÔ∏è Eliminar
                    </button>
                  </div>
                </div>
                
                <div class="review-meta">
                  <span class="review-date">{{ formatDate(review.fecha) }}</span>
                  <div class="stars-inline">
                    <ion-icon 
                      *ngFor="let star of getStarsArray(review.calificacion)" 
                      name="star" 
                      color="warning">
                    </ion-icon>
                  </div>
                </div>
                
                <p class="review-comment">{{ review.comentario }}</p>
              </div>
            </ion-card>
          </div>
        </div>
      </div>

      <!-- Secci√≥n de Animes -->
      <div class="animes-section">
        <h2 class="section-title">Animes Populares</h2>
        
        <div *ngIf="loading" class="loading-container">
          <ion-spinner name="crescent"></ion-spinner>
          <p>Cargando animes...</p>
        </div>

        <div *ngIf="!loading && animes.length === 0" class="no-results">
          <ion-icon name="sad-outline" size="large"></ion-icon>
          <p>No se encontraron animes</p>
        </div>

        <ion-card class="anime-card" *ngFor="let anime of animes" (click)="goToAnimeDetail(anime.id)">
          <div class="card-image">
            <img [src]="anime.image" [alt]="anime.title" *ngIf="anime.image">
            <div class="rating-overlay" *ngIf="anime.rating">
              <div class="stars">
                <ion-icon 
                  *ngFor="let star of getStarsArray(anime.rating)" 
                  name="star" 
                  color="warning">
                </ion-icon>
              </div>
              <span class="rating-number">{{ anime.rating | number:'1.1-1' }}</span>
            </div>
          </div>
          
          <div class="card-content">
            <div class="categories" *ngIf="anime.genres && anime.genres.length > 0">
              <ion-chip 
                *ngFor="let genre of anime.genres.slice(0, 2)" 
                color="primary" 
                size="small">
                {{ genre.toUpperCase() }}
              </ion-chip>
            </div>
            
            <h3 class="anime-title">{{ anime.title }}</h3>
            
            <div class="meta-info" *ngIf="anime.year">
              <span class="year">{{ anime.year }}</span>
              <span class="status" *ngIf="anime.status">{{ anime.status }}</span>
            </div>
            
            <p class="description" *ngIf="anime.description">
              {{ anime.description | slice:0:150 }}{{ (anime.description && anime.description.length > 150) ? '...' : '' }}
            </p>
            
            <ion-button fill="clear" class="read-more-btn">
              Ver detalles
              <ion-icon name="arrow-forward" slot="end"></ion-icon>
            </ion-button>
          </div>
        </ion-card>
      </div>
    </ion-content>
  </div>

  <!-- Secci√≥n de Rese√±as de Otros Usuarios -->
  <div class="other-reviews-section" *ngIf="otherUsersReviews.length > 0">
    <div class="section-header">
      <h2 class="section-title">Rese√±as de la Comunidad</h2>
      <ion-button 
        fill="clear" 
        size="small" 
        color="primary"
        (click)="refreshOtherReviews()">
        <ion-icon name="refresh" slot="start"></ion-icon>
        Actualizar
      </ion-button>
    </div>
    
    <div class="other-reviews-slider">
      <div class="slider-container">
        <ion-card class="other-review-card" *ngFor="let review of otherUsersReviews">
          <div class="card-image" *ngIf="review.photo">
            <img [src]="review.photo.webviewPath" [alt]="review.animeTitle">
            <div class="rating-overlay">
              <div class="stars">
                <ion-icon 
                  *ngFor="let star of getStarsArray(review.calificacion)" 
                  name="star" 
                  color="warning">
                </ion-icon>
              </div>
              <span class="rating-number">{{ review.calificacion }}/5</span>
            </div>
          </div>
          
          <div class="card-content">
            <div class="review-header">
              <h3 class="anime-title">{{ review.animeTitle }}</h3>
              <div class="user-info">
                <ion-icon name="person" size="small"></ion-icon>
                <span class="user-email">{{ review.userEmail }}</span>
              </div>
            </div>
            
            <div class="review-meta">
              <span class="review-date">{{ formatDate(review.fecha) }}</span>
              <div class="stars-inline">
                <ion-icon 
                  *ngFor="let star of getStarsArray(review.calificacion)" 
                  name="star" 
                  color="warning">
                </ion-icon>
              </div>
            </div>
            
            <p class="review-comment">{{ review.comentario }}</p>
          </div>
        </ion-card>
      </div>
    </div>
  </div>
</ion-content>
